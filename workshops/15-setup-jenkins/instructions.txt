
Workshop 15 : Create your own jenkins server

1. ssh to server
# ssh -i pem-files/automate-workshop.pem ubuntu@<your-server-ip>

2. Create user jenkins with uid = 1001
# sudo useradd -u 1001 --no-create-home jenkins
# sudo mkdir -p /bitnami/jenkins && sudo chown jenkins:jenkins /bitnami

3. Install docker on ubuntu
# sudo apt-get update
# sudo apt-get install -y curl
# curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
# sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"
# sudo apt-get update
# apt-cache policy docker-ce
# sudo apt-get install -y docker-ce
# sudo systemctl status docker
docker.service - Docker Application Container Engine
   Loaded: loaded (/lib/systemd/system/docker.service; enabled; vendor preset: enabled)
   Active: active (running) since Tue 2017-10-24 02:46:33 UTC; 4s ago
<press q to quit>

4. Add ubuntu and jenkins to docker group
# sudo usermod -a -G docker ubuntu
# sudo usermod -a -G docker jenkins

5. Create alias
# vim ~/.bashrc
// Put lines belows to the end of ~/.bashrc notice that you can replace my_username and my_password to your choice
alias pull-jenkins='docker pull 3dsinteractive/jenkins:2.81'
alias start-jenkins='docker run --rm --name jenkins -d -p 80:8080 -e JENKINS_USERNAME=my_username -e JENKINS_PASSWORD=my_password -v /bitnami/jenkins:/bitnami/jenkins -v /var/run/docker.sock:/var/run/docker.sock -v /usr/bin/docker:/usr/bin/docker 3dsinteractive/jenkins:2.81'
alias stop-jenkins='docker stop jenkins'
alias pull-composer='docker pull 3dsinteractive/composer:7.1'
alias docker-rmi-dangling='docker rmi $(docker images -f "dangling=true" -q)'

6. Exit and re-connect to server to allow docker to run without sudo
# exit
# ssh -i pem-files/automate-workshop.pem ubuntu@<your-server-ip>

7. Try with jenkins
# pull-jenkins
# pull-composer
# docker images
# start-jenkins
# docker ps
# stop-jenkins

8. Start jenkins and access through browser
# start-jenkins
# docker ps
<enter jenkins ip address into your browser address bar>
<enter username and password from the previous step>

9. Create 1st job to test if docker+jenkins work
- 6.1 Create a new job
- 6.2 Choose Freestyle project and name project "test-docker"
- 6.3 Press OK
- 6.4 Under Build section, Add build step -> Execute Shell
- 6.5 Enter => sudo docker run --rm hello-world
- 6.6 Save
- 6.7 Build now
